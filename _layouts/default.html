<!DOCTYPE html>
<html>
{% include head.html %}
  <body>
    <div class="content" id="header">
      {% include header.html %}
    </div>
    <div class="content" id="main-content">
      <div class="content-wrapper">
        <div id="react-app">
          {{ content }}
        </div>
      </div>
    </div>
    {% include footer.html %}
    {% include syntax_highlight.html %}
    
    <script type="text/babel">
      const { useState, useEffect } = React;
      
      // 页面内容映射
      const pageContent = {
        // 这里可以预加载关键页面的内容
      };
      
      function App() {
        const [currentPage, setCurrentPage] = useState(window.location.pathname);
        const [content, setContent] = useState(document.getElementById('react-app').innerHTML);
        const [loading, setLoading] = useState(false);
        
        // 更新活动菜单项
        useEffect(() => {
          const menuLinks = document.querySelectorAll('.menu a');
          menuLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href') === currentPage) {
              link.classList.add('active');
            }
          });
        }, [currentPage]);
        
        // 处理导航
        const handleNavigation = (path) => {
          setCurrentPage(path);
          setLoading(true);
          
          // 模拟页面加载
          setTimeout(() => {
            setLoading(false);
            window.history.pushState({}, '', path);
          }, 300);
        };
        
        // 监听浏览器前进后退按钮
        useEffect(() => {
          const handlePopState = () => {
            setCurrentPage(window.location.pathname);
          };
          
          window.addEventListener('popstate', handlePopState);
          
          // 清理事件监听器
          return () => {
            window.removeEventListener('popstate', handlePopState);
          };
        }, []);
        
        return (
          <div className={`page-transition ${loading ? 'loading' : ''}`}>
            <div dangerouslySetInnerHTML={{ __html: content }} />
          </div>
        );
      }
      
      // 渲染React应用
      ReactDOM.render(<App />, document.getElementById('react-app'));
    </script>
    
    <!-- 性能优化脚本 -->
    <script src="{{ "/assets/scripts/performance.js" | relative_url }}"></script>
    <script src="{{ "/assets/scripts/lcp-optimizer.js" | relative_url }}"></script>
    <script src="{{ "/assets/scripts/responsive-images.js" | relative_url }}"></script>
  </body>
</html>